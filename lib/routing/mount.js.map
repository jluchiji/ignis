{"version":3,"sources":["routing/mount.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;sBAQwB,QAAQ;;;;oBACR,MAAM;;;;qBACN,OAAO;;;;qBACP,OAAO;;;;yBAEJ,YAAY;;AAEvC,IAAO,KAAK,GAAG,wBAAM,aAAa,CAAC,CAAC;;AAEpC,IAAO,MAAM,GAAG;AACd,KAAG,EAAE,mBAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC9B,KAAG,EAAE,mBAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;AAChC,MAAI,EAAE,mBAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;AAChC,QAAM,EAAE,mBAAM,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC;CACjC,CAAC;;;;;;;;;;AASK,SAAS,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE;;;;;AAChC,MAAI,IAAI,CAAC,UAAU,EAAE;AAAE,QAAI,GAAG,IAAI,WAAQ,CAAC;GAAE;;AAE7C,MAAM,MAAM,GAAI,IAAI,CAAC,MAAM,IAAI,GAAG,CAAC;AACnC,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;;;;yBAGT,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC;;;;MAArC,IAAI;MAAE,GAAG;;AACf,MAAI,CAAC,IAAI,IAAI,CAAC,GAAG,EAAE;AAAE,UAAM,IAAI,KAAK,0BAAwB,IAAI,CAAC,IAAI,CAAG,CAAC;GAAE;;;AAG3E,KAAG,GAAG,oBAAE,SAAS,CAAC,kBAAK,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;AAC7C,MAAI,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;;AAE1B,OAAK,EAAI,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,CAAA,SAAI,GAAG,CAAG,CAAC;;;AAGxC,MAAM,UAAU,GAAG,oBAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CACvC,GAAG,CAAC,UAAA,OAAO;WAAI,OAAO,QAAO,IAAI,CAAC;GAAA,CAAC,CACnC,OAAO,EAAE,CACT,KAAK,EAAE,CAAC;;;AAGX,MAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACjC,UAAM,IAAI,KAAK,gDACgC,OAAO,OAAO,CAAG,CAAC;GAClE;AACD,YAAU,CAAC,IAAI,CAAC,2BAAW,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;;;AAG7C,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;AACzB,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;;AAE1C,MAAI,CAAC,MAAM,EAAE;AAAE,UAAM,IAAI,KAAK,+BAA6B,IAAI,CAAG,CAAC;GAAE;AACrE,QAAM,CAAC,IAAI,MAAA,CAAX,MAAM,GAAM,MAAM,EAAE,GAAG,4BAAK,UAAU,GAAC,CAAC;;AAExC,SAAO,IAAI,CAAC;CACb","file":"routing/mount.js","sourcesContent":["/**\n * routing/mount.js\n *\n * @author  Denis Luchkin-Zhou <denis@ricepo.com>\n * @license MIT\n */\n\n\nimport _           from 'lodash';\nimport Path        from 'path';\nimport Chalk       from 'chalk';\nimport Debug       from 'debug';\n\nimport { expressify } from 'ignis-util';\n\nconst  debug = Debug('ignis:mount');\n\nconst  styles = {\n  GET: Chalk.bold.blue('GET   '),\n  PUT: Chalk.bold.yellow('PUT   '),\n  POST: Chalk.bold.green('POST  '),\n  DELETE: Chalk.bold.red('DELETE')\n};\n\n/**\n * mount(2)\n *\n * @param          {path}      Root path of the handler to mount.\n * @param          {meta}      Ignis.js request handler with metadata.\n * @return         {this}      Namespace for further chaining.\n */\nexport function mount(path, meta) {\n  if (meta.__esModule) { meta = meta.default; }\n\n  const status  = meta.status || 200;\n  const handler = meta.handler;\n\n  /* Split out the HTTP verb and URL. */\n  let [ verb, url ] = meta.path.split(' ', 2); // eslint-disable-line prefer-const\n  if (!verb || !url) { throw new Error(`Invalid mount path: ${meta.path}`); }\n\n  /* Determine where to mount the endpoint */\n  url = _.trimRight(Path.join(path, url), '/');\n  verb = verb.toUpperCase();\n\n  debug(`${styles[verb] || verb} ${url}`);\n\n  /* Generate the middleware stack */\n  const middleware = _.chain(this.factories)\n    .map(factory => factory(this, meta))\n    .compact()\n    .value();\n\n  /* Push the handler into the middleware stack */\n  if (typeof handler !== 'function') {\n    throw new Error(\n      `Expected handler to be a function but got ${typeof handler}`);\n  }\n  middleware.push(expressify(handler, status));\n\n  /* Mount the middleware stack to the root router */\n  const router = this.root;\n  const method = router[verb.toLowerCase()];\n\n  if (!method) { throw new Error(`HTTP verb not supported: ${verb}`); }\n  method.call(router, url, ...middleware);\n\n  return this;\n}\n"],"sourceRoot":"/source/"}