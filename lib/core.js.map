{"version":3,"sources":["core.js"],"names":[],"mappings":"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","file":"core.js","sourcesContent":["/**\n * core.js\n *\n * @author  Denis Luchkin-Zhou <denis@ricepo.com>\n * @license MIT\n */\n\nimport _           from 'lodash';\nimport Debug       from 'debug';\nimport Chalk       from 'chalk';\nimport Express     from 'express';\nimport Prequire    from 'parent-require';\nimport Bluebird    from 'bluebird';\nimport Monologue   from 'monologue.js';\n\nimport { symbol }  from 'ignis-util';\n\nconst debug = Debug('ignis:core');\n\n/*!\n * Export symbols used by Ignis class.\n */\nconst init = symbol('Ignis::core::init');\nconst exts = symbol('Ignis::core::exts');\n\n\n/*!\n * Global Ignis instance.\n */\nlet instance = null;\n\n\n/**\n * IgnisApp\n *\n * @description Ignis application class.\n */\nfunction Ignis(arg) {\n\n  /* Get/set the global instance if this is called as function */\n  if (!(this instanceof Ignis)) {\n    if (arg === null || arg instanceof Ignis) {\n      debug(`${Chalk.red('[replace]')} singleton`);\n      instance = arg;\n    }\n    if (!instance) {\n      debug(`${Chalk.green('[create]')} singleton`);\n      instance = new Ignis();\n    }\n    return instance;\n  }\n\n  /* Otherwise, this is a class constructor. */\n  this[init]      = new Set();\n  this.root       = Express();\n  this.startup    = Bluebird.resolve();\n  this.factories  = [ ];\n\n  this.init();\n}\nIgnis.prototype = new Monologue();\nexport default Ignis;\n\n\n/**\n * init(0)\n *\n * @description              Runs all initializers that have not been run on\n *                           this Ignis instance.\n */\nIgnis.prototype.init = function() {\n  Ignis[init].forEach(fn => {\n    if (this[init].has(fn)) { return; }\n    this[init].add(fn);\n    fn.call(this);\n  });\n};\n\n\n/**\n * wait(1)\n *\n * @access         public\n * @description                Makes Ignis wait for the promise before starting.\n * @param          {action}    Function to call and wait for.\n * @returns        {Ignis}     Ignis instance for further chaining.\n */\nIgnis.prototype.wait = function(action) {\n  if (typeof action === 'function') {\n    this.startup = this.startup.then(() => action.call(this, this.root));\n  } else {\n    throw new Error('Cannot wait on non-function objects.');\n  }\n  return this;\n};\n\n\n/**\n * listen(1)\n *\n * @description                Creates an Express.js application, mounts the\n *                             root router and listens for connections on the\n *                             specified port.\n * @param          {port}      [Optional] Port to listen on (default: PORT)\n * @returns        {promise}   Rejects when an error occurs.\n */\nIgnis.prototype.listen = function(port) {\n  debug(`${Chalk.yellow('[call]')} Ignis::listen()`);\n  if (typeof port !== 'number') { port = Number(process.env.PORT); }\n  this.wait(() =>\n    Bluebird.fromNode((done) => {\n      this.root.listen(port, done);\n    })\n    .tap(() => debug(`${Chalk.cyan('[success]')} Ignis::listen()`))\n  );\n  return this.startup;\n};\n\n\n  /**\n   * use(1)\n   *\n   * @access         public\n   * @description                Make Ignis use the extension.\n   * @param          {fn}        Function exported by the extension module.\n   * @returns        {Ignis}     Ignis class for further chaining.\n   */\nIgnis.prototype.use = function(fn, ...args) {\n  this.wait(() => Ignis.use.call(this, fn, ...args));\n  return this;\n};\n\n\n/*!\n * Initializers: these are called every time an Ignis instance is created.\n */\nIgnis[init] = [ ];\n\n\n/*!\n * Extensions: tracks which extensions are already attached to the Ignis.\n */\nIgnis[exts] = new Set();\n\n\n/**\n * init(1)\n *\n * @description                Pushes the initializer callback into the Ignis\n *                             initializer stack.\n * @param          {fn}        Initializer function to push.\n */\nIgnis.init = function(fn) {\n  Ignis[init].push(fn);\n};\n\n\n/**\n * use(1)\n *\n * @access         public\n * @description                Make Ignis use the extension.\n * @param          {fn}        Function exported by the extension module.\n * @returns        {Ignis}     Ignis class for further chaining.\n */\nIgnis.use = function(fn, ...args) {\n  /* If fn is a string, load it first */\n  if (_.isString(fn)) { fn = Prequire(fn); }\n  /* Handle ES6 modules with multiple exports */\n  if (fn.__esModule) { fn = fn.default; }\n  /* No-op if this extension is already attached */\n  if (Ignis[exts].has(fn)) { return Ignis; }\n  Ignis[exts].add(fn);\n  fn(Ignis, ...args);\n  if (this !== Ignis) { this.init(); }\n};\n"],"sourceRoot":"/source/"}