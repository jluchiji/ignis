{"version":3,"sources":["config/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;sBAOwB,QAAQ;;;;qBACR,OAAO;;;;qBACP,OAAO;;;;yBACP,YAAY;;IAAxB,IAAI;;oBAEQ,QAAQ;;;;qBACR,SAAS;;;;AAEjC,IAAM,KAAK,GAAG,wBAAM,cAAc,CAAC,CAAC;;;;;AAKpC,IAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC;;;;;AAKpD,IAAM,YAAY,GAAG,gBAAgB,CAAC;;;;;;;;;;;;AAY/B,SAAS,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE;AAClC,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC;AAC5B,MAAM,GAAG,GAAG,oBAAE,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;;;AAG/B,MAAI,OAAO,KAAK,KAAK,WAAW,EAAE;;AAEhC,QAAI,OAAO,GAAG,KAAK,WAAW,EAAE;AAC9B,YAAM,IAAI,KAAK,sBAAmB,IAAI,wBAAoB,CAAC;KAC5D;AACD,WAAO,GAAG,CAAC;GACZ;;;AAGD,MAAI,CAAC,WAAW,CAAC,KAAK,EAAE,UAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAK;AACnC,QAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;AACjD,UAAM,GAAG,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC3B,UAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC/B,WAAK,YAAU,GAAG,CAAG,CAAC;AACtB,UAAI,CAAC,KAAK,EAAE;AAAE,cAAM,IAAI,KAAK,qBAAmB,GAAG,CAAG,CAAC;OAAE;AACzD,OAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;KACd;GACF,CAAC,CAAC;;;AAGH,sBAAE,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;AAC1B,MAAM,EAAE,GAAG,AAAC,OAAO,GAAG,KAAK,WAAW,GAAI,KAAK,GAAG,UAAU,CAAC;AAC7D,OAAK,CAAI,mBAAM,MAAM,CAAC,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC,SAAI,IAAI,CAAG,CAAC;AACjD,MAAI,CAAC,IAAI,aACG,EAAE,EACZ;AACE,QAAI,EAAM,IAAI;AACd,YAAQ,EAAE,GAAG;AACb,YAAQ,EAAE,KAAK;GAChB,CACF,CAAC;AACF,SAAO,IAAI,CAAC;CACb;;;;;;AAMM,SAAS,IAAI,GAAG;AACrB,MAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACpC,MAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,MAAI,CAAC,MAAM,CAAC,GAAG,GAAG,mBAAM,IAAI,CAAC,IAAI,CAAC,CAAC;AACnC,MAAI,CAAC,MAAM,CAAC,IAAI,GAAG,kBAAK,IAAI,CAAC,IAAI,CAAC,CAAC;CACpC;;;;;;qBAMc,UAAS,KAAK,EAAE;AAC7B,OAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CAClB","file":"config/index.js","sourcesContent":["/**\n * config/index.js\n *\n * @author  Denis Luchkin-Zhou <denis@ricepo.com>\n * @license MIT\n */\n\nimport _           from 'lodash';\nimport Debug       from 'debug';\nimport Chalk       from 'chalk';\nimport * as Util   from 'ignis-util';\n\nimport File        from './file';\nimport Envar       from './envar';\n\nconst debug = Debug('ignis:config');\n\n/*!\n * Export symbols used by config(2).\n */\nconst __store = Util.symbol('Ignis::config::store');\n\n/*!\n * Regex for envar substitutions.\n */\nconst substPattern = /^\\$[A-Z0-9_]+$/;\n\n\n/**\n * config(2)\n *\n * @description                Sets the configuration value if one is provided;\n *                             Otherwise returns the configuration value.\n * @param          {name}      Name of the configuration to get/set.\n * @param          {value}     [Optional] Value of the configuration to set.\n * @returns                    {this} for set; config value for get.\n */\nexport function config(name, value) {\n  const store = this[__store];\n  const old = _.get(store, name);\n\n  /* Get config value if available */\n  if (typeof value === 'undefined') {\n    /* Always check that config exists */\n    if (typeof old === 'undefined') {\n      throw new Error(`Config option '${name}' is not defined.`);\n    }\n    return old;\n  }\n\n  /* Substitute envars as specified */\n  Util.deepForEach(value, (v, k, o) => {\n    if (typeof v === 'string' && substPattern.test(v)) {\n      const key = v.substring(1);\n      const envar = process.env[key];\n      debug(`subst ${key}`);\n      if (!envar) { throw new Error(`Missing envar: ${key}`); }\n      o[k] = envar;\n    }\n  });\n\n  /* Otherwise, set the config value */\n  _.set(store, name, value);\n  const ev = (typeof old === 'undefined') ? 'set' : 'modified';\n  debug(`${Chalk.yellow('[' + ev + ']')} ${name}`);\n  this.emit(\n    `config.${ev}`,\n    {\n      name:     name,\n      oldValue: old,\n      newValue: value\n    }\n  );\n  return this;\n}\n\n\n/*!\n * Initializer\n */\nexport function init() {\n  this[__store] = Object.create(null);\n  this.config = config;\n  this.config.env = Envar.bind(this);\n  this.config.file = File.bind(this);\n}\n\n\n/*!\n * Ignis.js extension\n */\nexport default function(Ignis) {\n  Ignis.init(init);\n}\n"],"sourceRoot":"/source/"}